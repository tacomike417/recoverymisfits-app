<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Recovery Misfits</title>

  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#ffffff" />
  <link rel="icon" href="./icon-192.png">

  <style>
    body{font-family:Roboto,Arial,sans-serif;margin:0;background:#fff;color:#111;}
    header{position:sticky;top:0;z-index:9000;background:#fff;border-bottom:1px solid rgba(0,0,0,.12);padding:10px 12px;display:flex;align-items:center;justify-content:space-between;}
    .brand{font-weight:900;font-size:16px;}
    button{padding:9px 12px;border-radius:999px;border:1px solid rgba(0,0,0,.18);background:#fff;font-weight:900;cursor:pointer;color:#111;}
    button.primary{background:#111;color:#fff;}
    button:disabled{opacity:.55;cursor:not-allowed;}

    .frameWrap{height:200px;}
    iframe{width:100%;height:100%;border:0;background:#fff;display:block;}

    /* Install bar */
    #rm-install-bar{display:none;position:sticky;top:52px;z-index:9500;background:#fff;border-bottom:1px solid rgba(0,0,0,.12);}
    #rm-install-inner{max-width:980px;margin:0 auto;padding:10px 12px;display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;}
    #rm-install-title{font-weight:1000;font-size:13px;}
    #rm-install-sub{font-weight:800;font-size:12px;color:#666;}
    #rm-install-actions{display:flex;gap:8px;align-items:center;}

    /* Bottom bar */
    .bottomBar{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid rgba(0,0,0,.12);padding:10px 10px calc(10px + env(safe-area-inset-bottom));z-index:9999;}
    .bottomInner{max-width:980px;margin:0 auto;display:grid;grid-template-columns:1fr 1fr;gap:10px;}
    .pill{border:1px solid rgba(0,0,0,.18);border-radius:16px;padding:10px 12px;display:flex;align-items:center;justify-content:space-between;cursor:pointer;}
    .label{font-size:12px;font-weight:900;opacity:.7;}
    .value{font-size:14px;font-weight:1000;}
    .hint{font-size:12px;font-weight:900;color:#666;}

    /* Sheets */
    .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;z-index:10000;}
    .sheet{position:fixed;left:0;right:0;bottom:0;background:#fff;border-radius:18px 18px 0 0;padding:14px;transform:translateY(110%);transition:.2s;z-index:10001;}
    .sheet.open{transform:translateY(0);}
    input{width:100%;padding:10px;border-radius:12px;border:1px solid rgba(0,0,0,.18);margin-top:8px;font-weight:800;}
    .row{display:flex;gap:10px;margin-top:10px;}
    .big{font-size:22px;font-weight:1000;margin-top:10px;}
  </style>
</head>

<body>

<header>
  <div class="brand">Recovery Misfits</div>
  <button id="openBlog">Open Blog</button>
</header>

<!-- Install bar -->
<div id="rm-install-bar">
  <div id="rm-install-inner">
    <div>
      <div id="rm-install-title">Install the app</div>
      <div id="rm-install-sub"></div>
    </div>
    <div id="rm-install-actions">
      <button id="rm-install-btn" class="primary">Add to Home Screen</button>
    </div>
  </div>
</div>

<div class="frameWrap" id="frameWrap">
  <iframe src="https://recoverymisfits.blogspot.com/"></iframe>
</div>

<!-- Bottom Bar -->
<div class="bottomBar">
  <div class="bottomInner">
    <div class="pill" id="sobPill">
      <div>
        <div class="label">SOBRIETY</div>
        <div class="value" id="sobValue">Tap to set</div>
      </div>
      <div class="hint" id="sobHint">Tap to set</div>
    </div>

    <div class="pill" id="streakPill">
      <div>
        <div class="label">DAILY CHECK-IN</div>
        <div class="value" id="streakValue">—</div>
      </div>
      <div class="hint">Today</div>
    </div>
  </div>
</div>

<!-- Sobriety Sheet -->
<div class="backdrop" id="backdrop"></div>
<div class="sheet" id="sheet">
  <div style="display:flex;justify-content:space-between;">
    <h3>Sobriety</h3>
    <button id="closeSheet">Close</button>
  </div>
  <input type="date" id="sobDate">
  <div class="row">
    <button id="saveSob" class="primary">Save</button>
    <button id="clearSob">Clear</button>
  </div>
  <div class="big" id="sobOut"></div>
</div>

<!-- iOS Install Instructions -->
<div class="backdrop" id="iosBackdrop"></div>
<div class="sheet" id="iosSheet">
  <h3>Add to Home Screen</h3>

  <div style="margin-top:12px;font-weight:900;">
    <div style="margin-bottom:12px;">
      <b>1)</b> Tap the iPhone <b>Share</b> button
      <span style="margin-left:6px;border:1px solid #ccc;border-radius:8px;padding:2px 8px;">⤴︎</span>
    </div>
    <div style="margin-bottom:12px;">
      <b>2)</b> Scroll and tap <b>Add to Home Screen</b>
    </div>
    <div>
      <b>3)</b> Tap <b>Add</b>
    </div>
  </div>

  <div class="row">
    <button id="closeIOS">Close</button>
  </div>
</div>

<script>
  const BLOG_URL = "https://recoverymisfits.blogspot.com/";
  document.getElementById("openBlog").onclick = () => window.open(BLOG_URL,"_blank");

  const ios = /iphone|ipad|ipod/i.test(navigator.userAgent);
  const standalone = window.navigator.standalone;

  const installBar = document.getElementById("rm-install-bar");
  const installBtn = document.getElementById("rm-install-btn");
  const iosSheet = document.getElementById("iosSheet");
  const iosBackdrop = document.getElementById("iosBackdrop");

  if (ios && !standalone) {
    installBar.style.display="block";
    installBtn.onclick = () => {
      iosBackdrop.style.display="block";
      iosSheet.classList.add("open");
    };
  }

  document.getElementById("closeIOS").onclick = () => {
    iosSheet.classList.remove("open");
    iosBackdrop.style.display="none";
  };

  // Sobriety logic (unchanged)
  const sobValue=document.getElementById("sobValue");
  const sobHint=document.getElementById("sobHint");
  const sobDate=document.getElementById("sobDate");
  const sobOut=document.getElementById("sobOut");

  function renderSob(){
    const v=localStorage.getItem("sob");
    if(!v){sobValue.textContent="Tap to set";return;}
    const d0=new Date(v+"T00:00");
    const d1=new Date();
    const days=Math.floor((d1-d0)/86400000);
    sobValue.textContent="Sober: "+days+" days";
    sobOut.textContent=days+" days sober";
  }

  document.getElementById("sobPill").onclick=()=>{
    document.getElementById("backdrop").style.display="block";
    document.getElementById("sheet").classList.add("open");
  };
  document.getElementById("closeSheet").onclick=()=>{
    document.getElementById("sheet").classList.remove("open");
    document.getElementById("backdrop").style.display="none";
  };
  document.getElementById("saveSob").onclick=()=>{
    if(sobDate.value)localStorage.setItem("sob",sobDate.value);
    renderSob();
  };
  document.getElementById("clearSob").onclick=()=>{
    localStorage.removeItem("sob");
    renderSob();
  };

  renderSob();
</script>

</body>
</html>
