<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Trudge the Road</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
html,body{
  margin:0;
  padding:0;
  background:#000;
  overflow:hidden;
  font-family:"Press Start 2P", monospace;
  touch-action:none;
}
canvas{
  width:100vw;
  height:100vh;
  display:block;
}
</style>
</head>

<body>
<canvas id="game"></canvas>

<script>
(() => {

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let W=0, H=0;
function resize(){
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* =========================
   RUNNER
========================= */
const runnerImg = new Image();
runnerImg.src = "./runner.png";
let runnerReady = false;
runnerImg.onload = () => runnerReady = true;

/* =========================
   GAME STATE
========================= */
let mode = "title"; // title | play | win | gameover

const MAX_LIVES = 5;
let lives = MAX_LIVES;

const steps = [
  "HONESTY","HOPE","FAITH","COURAGE","INTEGRITY","WILLINGNESS",
  "HUMILITY","BROTHERLY LOVE","DISCIPLINE","PERSEVERANCE",
  "SPIRITUAL AWARENESS","SERVICE"
];
let stepIndex = 0;

/* =========================
   PLAYER (YOU ARE BILL)
========================= */
const player = {
  x: 120,
  y: H/2,
  w: 100,
  h: 140,
  vy: 0
};

const CENTER_Y = () => H/2;
const EDGE_PADDING = 80;

/* =========================
   TOUCH CONTROL (FREE + COMFY)
========================= */
let dragging = false;
let fingerY = null;

canvas.addEventListener("pointerdown", e=>{
  if(mode==="title"){ mode="play"; return; }
  if(mode==="gameover"||mode==="win"){ resetGame(); return; }
  dragging = true;
  fingerY = e.clientY;
});

canvas.addEventListener("pointermove", e=>{
  if(!dragging) return;
  fingerY = e.clientY - 60; // offset so thumb doesn't cover Bill
});

canvas.addEventListener("pointerup", ()=>{
  dragging = false;
  fingerY = null;
});

/* =========================
   BANNER (NO BACKLOG)
========================= */
let banner = null;
let bannerTimer = 0;

function showBanner(text, time=60){
  banner = text;
  bannerTimer = time;
}

/* =========================
   CELEBRATION
========================= */
let confetti = [];

function spawnConfetti(){
  for(let i=0;i<80;i++){
    confetti.push({
      x: Math.random()*W,
      y: H+20,
      vy: -4 - Math.random()*4,
      vx: -2 + Math.random()*4,
      emoji: Math.random()>0.5 ? "ðŸª™" : "âœ¨"
    });
  }
}

/* =========================
   RESET
========================= */
function resetGame(){
  lives = MAX_LIVES;
  stepIndex = 0;
  mode = "title";
  confetti = [];
}

/* =========================
   UPDATE
========================= */
function update(){

  if(mode==="play"){

    // FOLLOW FINGER
    if(fingerY!==null){
      player.y += (fingerY - player.y) * 0.25;
    } else {
      // gentle drift to center
      player.y += (CENTER_Y() - player.y) * 0.02;
    }

    // soft edges
    if(player.y < EDGE_PADDING){
      player.y += (EDGE_PADDING - player.y) * 0.2;
    }
    if(player.y > H-EDGE_PADDING){
      player.y -= (player.y - (H-EDGE_PADDING)) * 0.2;
    }

    // fake step progression for demo feel
    if(Math.random()<0.004){
      stepIndex++;
      showBanner(`STEP ${stepIndex} â€” ${steps[stepIndex-1]}`, 50);
      if(stepIndex>=12){
        mode="win";
        spawnConfetti();
      }
    }
  }

  if(bannerTimer>0) bannerTimer--;
  else banner=null;

  // confetti physics
  confetti.forEach(c=>{
    c.y += c.vy;
    c.x += c.vx;
  });
}

/* =========================
   DRAW HELPERS
========================= */
function drawTextBox(x,y,w,h){
  ctx.fillStyle="rgba(255,255,255,0.95)";
  ctx.fillRect(x,y,w,h);
  ctx.strokeStyle="#000";
  ctx.lineWidth=3;
  ctx.strokeRect(x,y,w,h);
}

function wrapText(text,x,y,maxW,lineH){
  const words = text.split(" ");
  let line="";
  for(let i=0;i<words.length;i++){
    const test = line+words[i]+" ";
    if(ctx.measureText(test).width>maxW){
      ctx.fillText(line,x,y);
      line=words[i]+" ";
      y+=lineH;
    } else line=test;
  }
  ctx.fillText(line,x,y);
}

/* =========================
   DRAW
========================= */
function draw(){
  ctx.clearRect(0,0,W,H);

  if(mode==="title"){
    ctx.fillStyle="#fff";
    ctx.textAlign="center";
    ctx.font="28px 'Press Start 2P'";
    ctx.fillText("TRUDGE",W/2,120);
    ctx.fillText("THE ROAD",W/2,160);

    const boxW = Math.min(W-40,700);
    drawTextBox((W-boxW)/2,200,boxW,220);

    ctx.fillStyle="#000";
    ctx.font="11px 'Press Start 2P'";
    wrapText("GOAL: Go through the Steps IN ORDER", (W-boxW)/2+20,240,boxW-40,28);
    wrapText("Pitfalls: Lose a life", (W-boxW)/2+20,300,boxW-40,28);
    wrapText("Actions (blue clouds): Gain a life", (W-boxW)/2+20,360,boxW-40,28);

    ctx.fillStyle="#fff";
    ctx.font="12px 'Press Start 2P'";
    ctx.fillText("TAP TO START",W/2,470);
  }

  if(mode==="play"){
    // HUD
    ctx.fillStyle="#fff";
    ctx.font="12px 'Press Start 2P'";
    ctx.textAlign="left";
    ctx.fillText(`STEP ${stepIndex+1} / 12`,20,30);
    ctx.textAlign="right";
    ctx.fillText(steps[stepIndex]||"",W-20,30);

    // PLAYER
    if(runnerReady){
      ctx.drawImage(runnerImg,0,0,runnerImg.width,runnerImg.height,
        player.x,player.y-player.h/2,player.w,player.h);
    } else {
      ctx.fillRect(player.x,player.y-70,80,120);
    }

    // BANNER
    if(banner){
      ctx.fillStyle="rgba(0,0,0,0.75)";
      ctx.fillRect(W/2-220,80,440,60);
      ctx.fillStyle="#fff";
      ctx.textAlign="center";
      ctx.font="12px 'Press Start 2P'";
      ctx.fillText(banner,W/2,120);
    }
  }

  if(mode==="win"){
    ctx.fillStyle="#fff";
    ctx.textAlign="center";
    ctx.font="16px 'Press Start 2P'";
    ctx.fillText("YOU MADE IT THROUGH THE STEPS!",W/2,120);

    confetti.forEach(c=>{
      ctx.font="20px serif";
      ctx.fillText(c.emoji,c.x,c.y);
    });

    ctx.font="12px 'Press Start 2P'";
    ctx.fillText("TAP TO PLAY AGAIN",W/2,H-60);
  }
}

/* =========================
   LOOP
========================= */
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();

})();
</script>
</body>
</html>
